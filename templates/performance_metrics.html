<!-- Font links -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Archivo:ital,wght@1,100&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=El+Messiri&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300&display=swap" rel="stylesheet">


<!-- Block title and block description -->
{% extends "base.html" %}
{% block title %} <h2 style="font-family: 'El Messiri', sans-serif; font-weight: 300;"> Performance Metrics </h2> {% endblock %}
{% block description %} <h5 style="font-family: 'Archivo', sans-serif;"> See detailed analysis and metrics for your time series data. </h5> {% endblock %}


<!-- Block content -->
{% block content %}

<p style= "font-family: 'Open Sans', sans-serif;">On this page you will find plots that summarize the performance of your time series data, helping you<br>
to understand patterns, trends, and potential issues. <br>
<br>
Our advanced algorithms automatically compute a range of performance metrics, including mean absolute error,<br>
mean average percentage error, correlation coefficient, and more, providing you with accurate and reliable results. </p>

<!-- Search bar -->
<div class="row mb-5">
    <div class="input-group">
        <select id="select-dataset" class="form-select">
            <option value="default" selected>Select a Dataset</option>

            {% for name in dataset_ids %}
                <option value="{{name}}">{{name}}</option>
            {% endfor %}
        </select>
        <select id="select-forecast" class="form-select" style="display:none">
            <option value="default" name="default">Select A Forecast To View Metrics</option>
        </select>
    </div>
</div>

<div id="metadata" style="display:none">
    <div class="row mb-5">
        <div class="col">
            <h4>Description</h4>
            <p id="description"></p>
        </div>
        <div class="col">
            <h4>Reference</h4>
            <p id="reference"></p>
        </div>
        <div class="col">
            <h4>Link</h4>
            <p id="link"></p>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <h4>Contributors</h4>
            <ul id="contributors" class="list-group"></ul>
        </div>
        <div class="col">
            <h4>Keywords</h4>
            <ul id="keywords" class="list-group"></ul>
        </div>
        <div class="col">
            <h4>Domains</h4>
            <ul id="domains" class="list-group"></ul>
        </div>
    </div>
</div>

<div id="metrics" style="display: none;">
    <div class="row mb-5">
        <div class="col">
            <h4>MAE</h4>
            <p id="mae"></p>
        </div>
        <div class="col">
            <h4>MAPE</h4>
            <p id="mape"></p>
        </div>
        <div class="col">
            <h4>SMAPE</h4>
            <p id="smape"></p>
        </div>
        <div class="col">
            <h4>MSE</h4>
            <p id="mse"></p>
        </div>
        <div class="col">
            <h4>RMSE</h4>
            <p id="rmse"></p>
        </div>
    </div>
</div>

<script>
    function clear_contents() {
        $("#metadata").hide();
        $("#contributors").html("");
        $("#keywords").html("");
        $("#domains").html("");

        $("#metrics").hide();
        $("#mae").html("");
        $("#mape").html("");
        $("#smape").html("");
        $("#mse").html("");
        $("#rmse").html("");
    }

    function render_metadata(response) {
        // Update description
        $("#description").text(response.description);

        $("#reference").text(response.reference)
        $("#link").html("<a href='" + response.link + "' target='_blank'>" + response.link + "</a>");

        // Update contributors
        response.contributors.forEach(item => {
            $("#contributors").append("<li class='list-group-item'>" + item + "</li>")
        });

        // Update contributors
        response.keywords.forEach(item => {
            $("#keywords").append("<li class='list-group-item'>" + item + "</li>")
        });

        // Update contributors
        response.domains.forEach(item => {
            $("#domains").append("<li class='list-group-item'>" + item + "</li>")
        });

        $("#select-forecast").empty()
        $("#select-forecast").append("<option value='default' name='default'>Select A Forecast To View Metrics</option>")
        response.forecasts.forEach(item => {
            $("#select-forecast").append("<option value='" + item + "' name='"+ item +"'>"+ item +"</option>")
        })

        $("#select-forecast").show()
    }


    function render_metrics(response){
        // Update description
        $("#description").text(response.description);

        $("#reference").text(response.reference)
        $("#link").html("<a href='" + response.link + "' target='_blank'>" + response.link + "</a>");

        // Update contributors
        response.contributors.forEach(item => {
            $("#contributors").append("<li class='list-group-item'>" + item + "</li>")
        });

        // Update contributors
        response.keywords.forEach(item => {
            $("#keywords").append("<li class='list-group-item'>" + item + "</li>")
        });

        // Update contributors
        response.domains.forEach(item => {
            $("#domains").append("<li class='list-group-item'>" + item + "</li>")
        });

        //update mae
        $("#mae").text(response.mae);
        //update mape
        $("#mape").text(response.mape);
        //update smape
        $("#smape").text(response.smape);
        //update mse
        $("#mse").text(response.mse);
        //update rmse
        $("#rmse").text(response.rmse);
    }

    $(document).ready(function() {

        // View selected metadata
        $("#select-dataset").change(function() {
            $.ajax({
                url: "",
                type: "get",
                contentType: "application/json",
                data: {
                    dataset_id: $("#select-dataset").val(), forecast_name: $("select-forecast").val()
                },
                success: function(response) {
                    if (response) {
                        clear_contents();
                        $("#metadata").show();
                        render_metadata(response);
                    } else {
                        clear_contents();
                    }
                }
            });
        });

        $("#select-forecast").change(function() {
            $.ajax({
                url: "",
                type: "get",
                contentType: "application/json",
                data: {
                    dataset_id: $("#select-dataset").val(), 
                    forecast_name: $("#select-forecast").val()
                },
                success: function(response) {
                    if (response) {
                        clear_contents()
                        $("#metadata").show()
                        if (response.mae) {
                            $("#metrics").show();
                        }
                        render_metrics(response);
                    } else {
                        clear_contents();
                    }
                }
            });
        });
    });
</script>

{% endblock %}